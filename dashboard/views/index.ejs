<%- include('layout', { title: 'Dashboard' }) %>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
    <div class="stats-card p-6 bg-nord-1 rounded-xl shadow-xl hover:shadow-2xl transition-all duration-300">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-nord-10 bg-opacity-10">
                <svg class="h-8 w-8 text-nord-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                </svg>
            </div>
            <div class="ml-4">
                <h2 class="text-xl font-semibold text-nord-4">Bot Status</h2>
                <p class="mt-1">
                    <span class="text-2xl font-bold text-nord-8 bot-status">Online</span>
                </p>
            </div>
        </div>
    </div>

    <div class="stats-card p-6 bg-nord-1 rounded-xl shadow-xl hover:shadow-2xl transition-all duration-300">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-nord-14 bg-opacity-10">
                <svg class="h-8 w-8 text-nord-14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
            </div>
            <div class="ml-4">
                <h2 class="text-xl font-semibold text-nord-4">Active Users</h2>
                <p class="mt-1">
                    <span class="text-2xl font-bold text-nord-14"><%= locals.activeUsers || 0 %></span>
                </p>
            </div>
        </div>
    </div>

    <div class="stats-card p-6 bg-nord-1 rounded-xl shadow-xl hover:shadow-2xl transition-all duration-300">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-nord-13 bg-opacity-10">
                <svg class="h-8 w-8 text-nord-13" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <div class="ml-4">
                <h2 class="text-xl font-semibold text-nord-4">Response Time</h2>
                <p class="mt-1">
                    <span class="text-2xl font-bold text-nord-13"><%= (locals.avgResponseTime || 0).toFixed(2) %>s</span>
                </p>
            </div>
        </div>
    </div>

    <div class="stats-card p-6 bg-nord-1 rounded-xl shadow-xl hover:shadow-2xl transition-all duration-300">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-nord-15 bg-opacity-10">
                <svg class="h-8 w-8 text-nord-15" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
            </div>
            <div class="ml-4">
                <h2 class="text-xl font-semibold text-nord-4">Messages Today</h2>
                <p class="mt-1">
                    <span class="text-2xl font-bold text-nord-15"><%= locals.messageCount || 0 %></span>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div class="bg-nord-1 rounded-xl shadow-xl p-6 transform hover:scale-[1.02] transition-all duration-300">
        <h3 class="text-xl font-semibold text-nord-8 mb-4">Recent Activity</h3>
        <div class="overflow-hidden">
            <table class="min-w-full divide-y divide-nord-2">
                <thead>
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-nord-4 uppercase tracking-wider">Time</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-nord-4 uppercase tracking-wider">Event</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-nord-4 uppercase tracking-wider">Details</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-nord-2">
                    <% if (locals.recentActivity && recentActivity.length > 0) { %>
                        <% recentActivity.forEach(activity => { %>
                            <tr class="hover:bg-nord-2 transition-colors duration-150">
                                <td class="px-6 py-4 whitespace-nowrap text-sm"><%= activity.time %></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm"><%= activity.event %></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm"><%= activity.details %></td>
                            </tr>
                        <% }) %>
                    <% } else { %>
                        <tr>
                            <td colspan="3" class="px-6 py-4 text-center text-sm text-nord-4">No recent activity</td>
                        </tr>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>

    <div class="bg-nord-1 rounded-xl shadow-xl p-6 transform hover:scale-[1.02] transition-all duration-300">
        <h3 class="text-xl font-semibold text-nord-8 mb-4">System Status</h3>
        <div class="space-y-4">
            <div class="bg-nord-2 rounded-lg p-4">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-medium text-nord-4">Memory Usage</span>
                    <span class="text-sm text-nord-8" id="memoryUsage">...</span>
                </div>
                <div class="w-full bg-nord-3 rounded-full h-2">
                    <div class="bg-nord-8 rounded-full h-2 transition-all duration-500" id="memoryBar" style="width: 0%"></div>
                </div>
            </div>

            <div class="bg-nord-2 rounded-lg p-4">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-medium text-nord-4">CPU Usage</span>
                    <span class="text-sm text-nord-14" id="cpuUsage">...</span>
                </div>
                <div class="w-full bg-nord-3 rounded-full h-2">
                    <div class="bg-nord-14 rounded-full h-2 transition-all duration-500" id="cpuBar" style="width: 0%"></div>
                </div>
            </div>

            <div class="bg-nord-2 rounded-lg p-4">
                <div class="flex justify-between items-center">
                    <span class="text-sm font-medium text-nord-4">Uptime</span>
                    <span class="text-sm text-nord-13" id="uptime">...</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Update system stats every 5 seconds
    function updateSystemStats() {
        fetch('/stats/status')
            .then(response => response.json())
            .then(data => {
                const memoryUsage = (data.memoryUsage.heapUsed / data.memoryUsage.heapTotal * 100).toFixed(1);
                document.getElementById('memoryUsage').textContent = `${memoryUsage}%`;
                document.getElementById('memoryBar').style.width = `${memoryUsage}%`;

                const uptime = Math.floor(data.uptime / 3600);
                const minutes = Math.floor((data.uptime % 3600) / 60);
                document.getElementById('uptime').textContent = `${uptime}h ${minutes}m`;
            })
            .catch(console.error);
    }

    updateSystemStats();
    setInterval(updateSystemStats, 5000);
</script>